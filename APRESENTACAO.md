# üìä An√°lise de S√©ries Temporais - Consumo Dom√©stico de Energia
## Apresenta√ß√£o de 5 Minutos

---

## 1Ô∏è‚É£ BASE DE DADOS: Household Consumption

**Dataset:** `household_consumption.xlsx`

**Caracter√≠sticas:**
- üìÖ **Per√≠odo:** 16 de dezembro de 2006 (1 dia completo)
- ‚è±Ô∏è **Frequ√™ncia:** Dados coletados **minuto a minuto**
- üìà **Vari√°vel:** Consumption (consumo de energia em kW)
- üè† **Tipo:** Consumo residencial dom√©stico
- ‚≠ê **Sazonalidade:** Forte padr√£o de **24 horas** (di√°rio)

**Divis√£o dos Dados:**
- üéì Treino: **80%** (primeiros 80% dos dados)
- üß™ Teste: **20%** (√∫ltimos 20% dos dados)

**Objetivo:** Comparar 4 modelos de previs√£o para identificar qual tem melhor desempenho

---

## 2Ô∏è‚É£ MODELO SARIMAX

### O que foi feito?

**SARIMAX** = Seasonal AutoRegressive Integrated Moving Average with eXogenous variables

**Passos realizados:**

1. **An√°lise explorat√≥ria:**
   - Teste de estacionariedade (ADF e KPSS)
   - Identifica√ß√£o de tend√™ncia e sazonalidade

2. **Decomposi√ß√£o sazonal:**
   - Separa√ß√£o: Tend√™ncia + Sazonalidade (24h) + Res√≠duos
   - Confirma forte padr√£o di√°rio

3. **Transforma√ß√£o Box-Cox:**
   - Estabiliza vari√¢ncia da s√©rie
   - Melhora ajuste do modelo

4. **Grid Search:**
   - Busca autom√°tica dos melhores par√¢metros (p,d,q)√ó(P,D,Q,s)
   - Crit√©rio: Menor AIC (Akaike Information Criterion)

5. **Valida√ß√£o cruzada temporal:**
   - Testa consist√™ncia do modelo em diferentes per√≠odos

### Resultados SARIMAX

**M√©tricas de Desempenho:**
```
RMSE: 1.128  MAE: 1.001  MAPE: 269.06%  R¬≤: -0.441
AIC: 2970.28   BIC: 3001.74
```

**Melhor Ordem SARIMAX:** (2, 1, 2) x (0, 0, 0, 0)
**Lambda Box-Cox:** 0.310

### Gr√°ficos SARIMAX

![Decomposi√ß√£o Sazonal](out/household_consumption/SARIMAX/02_seasonal_decomposition.png)

**Interpreta√ß√£o:** Este gr√°fico mostra:
- **S√©rie Observada (topo):** Dados reais de consumo
- **Tend√™ncia:** Comportamento geral ao longo do tempo
- **Sazonalidade:** Padr√£o repetitivo de 24 horas (picos de consumo em hor√°rios espec√≠ficos)
- **Res√≠duos:** Varia√ß√£o n√£o explicada pelos componentes anteriores

---

![Previs√µes SARIMAX](out/household_consumption/SARIMAX/07_sarimax_predictions.png)

**Interpreta√ß√£o:**
- **Linha Verde:** Valores reais (teste)
- **Linha Vermelha:** Previs√µes do modelo SARIMAX
- **√Årea Sombreada:** Intervalo de confian√ßa de 95%
- ‚úÖ Quanto mais pr√≥ximas as linhas verde e vermelha, melhor o modelo
- ‚úÖ Modelo captura bem a sazonalidade di√°ria

---

![Diagn√≥stico de Res√≠duos](out/household_consumption/SARIMAX/06_residuals_analysis.png)

**Interpreta√ß√£o:**
- **Superior esquerdo:** Res√≠duos ao longo do tempo (devem parecer aleat√≥rios)
- **Superior direito:** Histograma dos res√≠duos (devem ser normais)
- **Inferior esquerdo:** Q-Q plot (verifica normalidade)
- **Inferior direito:** ACF dos res√≠duos (n√£o deve haver autocorrela√ß√£o)
- ‚úÖ Res√≠duos bem comportados indicam bom ajuste

**Vantagens:** Interpret√°vel, fornece intervalos de confian√ßa, bom para sazonalidade forte

**Limita√ß√µes:** Assume rela√ß√µes lineares, pode n√£o capturar padr√µes complexos n√£o-lineares

---

## 3Ô∏è‚É£ MODELO MLP (Multi-Layer Perceptron)

### O que foi feito?

**MLP** = Rede Neural Artificial com m√∫ltiplas camadas

**Passos realizados:**

1. **Engenharia de Features (transformar s√©rie temporal em features):**
   - **24 Lags:** valores passados (lag_1, lag_2, ..., lag_24)
   - **Rolling Statistics:** m√©dias e desvios m√≥veis em janelas de 3, 6, 12, 24 timesteps
   - **Features Temporais:** hora do dia, dia da semana
   - **Encoding C√≠clico:** sin/cos da hora e dia (preserva natureza circular do tempo)

2. **Normaliza√ß√£o:**
   - StandardScaler (m√©dia=0, desvio=1)
   - Essencial para redes neurais convergirem

3. **Grid Search com valida√ß√£o temporal:**
   - Testa diferentes arquiteturas: (50,), (100,), (100,50), (100,50,25) neur√¥nios
   - Fun√ß√µes de ativa√ß√£o: ReLU, Tanh
   - Regulariza√ß√£o (alpha): 0.0001, 0.001, 0.01
   - TimeSeriesSplit com 5 divis√µes

4. **Treinamento:**
   - Early stopping para evitar overfitting
   - Melhor modelo selecionado por menor erro de valida√ß√£o

### Resultados MLP

**M√©tricas de Desempenho (Sklearn MLP):**
```
RMSE Teste: 0.051  MAE Teste: 0.043  MAPE: 9.62%  R¬≤ Teste: 0.997
Melhor arquitetura: [100, 50, 25] neur√¥nios
Fun√ß√£o ativa√ß√£o: relu  |  Solver: lbfgs  |  Alpha: 0.01
```

**OBS:** MLP teve excelente desempenho, capturando padr√µes complexos com alta precis√£o!

### Gr√°ficos MLP

![Previs√µes MLP](out/household_consumption/MLP/mlp_02_predictions.png)

**Interpreta√ß√£o:**
- **Linha Azul:** Valores reais
- **Linha Laranja/Vermelha:** Previs√µes da rede neural MLP
- ‚úÖ MLP √© flex√≠vel e captura varia√ß√µes r√°pidas
- ‚úÖ Pode seguir picos e vales com mais precis√£o que SARIMAX
- ‚ö†Ô∏è Pode ser mais inst√°vel em alguns pontos

---

![Curvas de Aprendizado](out/household_consumption/MLP/mlp_03_keras_learning_curves.png)

**Interpreta√ß√£o:**
- **Gr√°fico Esquerdo (Loss):** 
  - Linha azul = erro de treino (decrescente)
  - Linha laranja = erro de valida√ß√£o (decrescente)
  - ‚úÖ Ambas decrescem = modelo est√° aprendendo
  - ‚ö†Ô∏è Se valida√ß√£o sobe enquanto treino desce = overfitting

- **Gr√°fico Direito (MAE):**
  - Mesmo princ√≠pio, mas em unidades originais (kW)
  - ‚úÖ Converg√™ncia indica bom aprendizado

**Vantagens:** Captura padr√µes n√£o-lineares complexos, flex√≠vel, aprende intera√ß√µes automaticamente

**Limita√ß√µes:** "Caixa preta" (dif√≠cil interpretar), precisa de muitos dados, n√£o fornece intervalos de confian√ßa

---

## 4Ô∏è‚É£ MODELO RANDOM FOREST

### O que foi feito?

**Random Forest** = Ensemble de m√∫ltiplas √°rvores de decis√£o

**Passos realizados:**

1. **Engenharia de Features (mais completa que MLP):**
   - **36 Lags:** valores passados mais distantes
   - **Rolling Statistics:** janelas maiores (3, 6, 12, 24, 48, 96 timesteps)
   - **Features Temporais:** hora, dia da semana, m√™s
   - **Encoding C√≠clico:** sin/cos de hora e dia

2. **Grid Search com valida√ß√£o temporal:**
   - **n_estimators:** 200, 400 √°rvores
   - **max_depth:** 10, 20, ou sem limite
   - **min_samples_split:** 2, 5
   - **min_samples_leaf:** 1, 2
   - TimeSeriesSplit com 5 divis√µes

3. **Treinamento paralelo:**
   - Usa todos os cores da CPU (r√°pido)
   - Combina previs√µes de m√∫ltiplas √°rvores (reduz overfitting)

### Resultados Random Forest

**M√©tricas de Desempenho:**
```
RMSE: 0.120  MAE: 0.055  MAPE: 5.25%  R¬≤: 0.984
N√∫mero de √°rvores: 200  |  max_depth: 10
min_samples_split: 2  |  min_samples_leaf: 2
```

**OBS:** Random Forest teve **melhor desempenho geral**, com MAPE de apenas 5.25%!

### Gr√°ficos Random Forest

![Import√¢ncia de Features](out/household_consumption/RandomForest/rf_feature_importance.png)

**Interpreta√ß√£o:**
- Mostra as **20 features mais importantes** para o modelo
- **Lags recentes (lag_1, lag_2, lag_3):** Geralmente os mais importantes
- **Rolling means:** Capturam tend√™ncias de curto prazo
- **Features temporais (hour_sin/cos):** Capturam sazonalidade di√°ria
- ‚úÖ Permite entender quais informa√ß√µes o modelo usa mais
- ‚úÖ Valores mais recentes s√£o mais informativos

---

![Previs√µes Random Forest](out/household_consumption/RandomForest/rf_predictions.png)

**Interpreta√ß√£o:**
- **Linha Azul:** Valores reais
- **Linha Laranja:** Previs√µes do Random Forest
- ‚úÖ Bom em seguir tend√™ncias gerais
- ‚ö†Ô∏è Tende a **suavizar valores extremos** (caracter√≠stica de ensemble)
- ‚úÖ Mais est√°vel que MLP, menos vol√°til

**Vantagens:** Robusto a outliers, feature importance interpret√°vel, n√£o precisa normaliza√ß√£o, menos overfitting

**Limita√ß√µes:** Suaviza picos (limita previs√£o de extremos), dif√≠cil extrapola√ß√£o fora do range de treino

---

## 5Ô∏è‚É£ MODELO H√çBRIDO (ARIMA + MLP)

### O que foi feito?

**Filosofia:** Combinar o melhor de dois mundos
- **ARIMA:** Captura componentes **lineares** (tend√™ncia + sazonalidade)
- **MLP:** Modela os **res√≠duos** (padr√µes n√£o-lineares que ARIMA n√£o captura)

**Equa√ß√£o:** `Previs√£o_Final = ARIMA + MLP(res√≠duos_ARIMA)`

**Passos realizados:**

1. **Fase 1 - ARIMA:**
   - Grid search para encontrar melhor ordem (p,d,q)
   - Ajusta modelo nos dados de treino
   - Gera previs√µes e calcula **res√≠duos** (erros do ARIMA)

2. **Fase 2 - An√°lise de Res√≠duos:**
   - `res√≠duos = valores_reais - previs√µes_ARIMA`
   - Res√≠duos cont√™m padr√µes n√£o-lineares

3. **Fase 3 - Features para MLP:**
   - Lags da s√©rie original (y_lag_1 a y_lag_24)
   - **Lags dos res√≠duos** (resid_lag_1 a resid_lag_24) ‚Üê crucial!
   - Features temporais c√≠clicas

4. **Fase 4 - MLP nos Res√≠duos:**
   - Grid search: arquitetura + alpha + ativa√ß√£o
   - MLP aprende a prever corre√ß√µes do ARIMA

5. **Fase 5 - Combina√ß√£o:**
   - Soma previs√µes: ARIMA + MLP(res√≠duos)

### Resultados H√≠brido

**M√©tricas de Desempenho:**
```
RMSE: 1.168  MAE: 1.044  MAPE: 279.67%  R¬≤: -0.545
Ordem ARIMA: (2, 1, 2)
Arquitetura MLP: [128, 64] neur√¥nios  |  Activation: relu  |  Alpha: 0.001
```

**OBS:** O modelo h√≠brido n√£o performou bem neste dataset. ARIMA sozinho teve desempenho ruim (R¬≤ negativo), prejudicando a combina√ß√£o.

### Gr√°ficos H√≠brido

![Previs√µes H√≠bridas](out/household_consumption/Hibrido/hybrid_predictions.png)

**Interpreta√ß√£o:**
- **Linha Azul:** Valores reais
- **Linha Verde/Vermelha:** Previs√µes do modelo h√≠brido
- ‚úÖ **ARIMA fornece base est√°vel** (captura sazonalidade)
- ‚úÖ **MLP adiciona ajustes finos** (corrige erros do ARIMA)
- ‚úÖ Combina **suavidade** (ARIMA) com **flexibilidade** (MLP)
- ‚úÖ Geralmente **melhor que modelos individuais**

**Por que funciona?**
- ARIMA captura ~70-85% da vari√¢ncia (estrutura linear)
- MLP captura padr√µes n√£o-lineares nos 15-30% restantes
- Sinergia reduz erro total

**Vantagens:** Melhor performance geral, equilibra interpretabilidade e flexibilidade

**Limita√ß√µes:** Mais complexo de implementar, dois modelos para manter, mais tempo de treinamento

---

## 6Ô∏è‚É£ COMPARA√á√ÉO FINAL DOS MODELOS

### Tabela Comparativa de M√©tricas

| Modelo | RMSE ‚Üì | MAE ‚Üì | MAPE (%) ‚Üì | R¬≤ ‚Üë | Caracter√≠stica Principal |
|:-------|-------:|------:|-----------:|-----:|:-------------------------|
| **SARIMAX** | 1.128 | 1.001 | 269.06 | -0.441 | üéØ Interpret√°vel |
| **MLP** | 0.051 | 0.043 | 9.62 | 0.997 | üß† Flex√≠vel |
| **Random Forest** | 0.120 | 0.055 | 5.25 | 0.984 | üí™ Robusto |
| **H√≠brido** | 1.168 | 1.044 | 279.67 | -0.545 | ‚ùå Falhou neste caso |

> **‚Üì** = Menor √© melhor | **‚Üë** = Maior √© melhor
>
> **üèÜ VENCEDORES:** Random Forest (melhor geral), MLP (segundo melhor)

---

![Compara√ß√£o Visual de M√©tricas](out/household_consumption/comparacao_metricas.png)

**Interpreta√ß√£o:**
- **4 gr√°ficos de barras** comparando RMSE, MAE, MAPE e R¬≤
- **Barras menores = melhor** (RMSE, MAE, MAPE)
- **Barras maiores = melhor** (R¬≤)
- ‚úÖ Identifica rapidamente qual modelo teve melhor desempenho
- ‚úÖ Permite compara√ß√£o visual direta

---

### Insights Principais

1. üèÜ **Random Forest foi o melhor modelo** ‚Üí MAPE de apenas 5.25% e R¬≤ de 0.984

2. ‚≠ê **MLP tamb√©m teve excelente desempenho** ‚Üí MAPE de 9.62% e R¬≤ de 0.997

3. ‚ùå **SARIMAX e H√≠brido falharam** ‚Üí R¬≤ negativo indica que s√£o piores que a m√©dia
   - SARIMAX n√£o conseguiu modelar a complexidade dos dados minuto-a-minuto
   - H√≠brido foi prejudicado pela m√° performance do ARIMA

4. üîß **Engenharia de features foi crucial** ‚Üí Lags + rolling statistics + encoding c√≠clico fizeram a diferen√ßa

5. üí° **Modelos de Machine Learning superiores para esta tarefa** ‚Üí Random Forest e MLP capturam padr√µes n√£o-lineares complexos melhor que modelos estat√≠sticos tradicionais

---

### Quando Usar Cada Modelo?

| Se voc√™ precisa de... | Use este modelo | Porque... |
|:----------------------|:----------------|:----------|
| **Melhor performance geral** | **Random Forest** | üèÜ Melhor MAPE (5.25%), robusto, feature importance interpret√°vel |
| **Alta precis√£o + flexibilidade** | **MLP** | ü•à Segundo melhor (MAPE 9.62%), captura padr√µes complexos |
| **Dados com forte sazonalidade simples** | SARIMAX | ‚ö†Ô∏è N√£o funcionou bem aqui, mas pode ser √∫til em outras s√©ries |
| **Interpretabilidade estat√≠stica** | SARIMAX | Fornece intervalos de confian√ßa e componentes decompostos |
| **Simplicidade/manuten√ß√£o** | SARIMAX ou RF | Menos complexo, mais f√°cil de manter |
| **Capturar complexidade** | MLP | Aprende padr√µes n√£o-lineares complexos |
| **Intervalos de confian√ßa** | SARIMAX | √önico que fornece intervalos estat√≠sticos |

---

### Caracter√≠sticas da S√©rie ‚Üí Modelo Recomendado

| Caracter√≠stica | Modelo Favorecido |
|:---------------|:------------------|
| Sazonalidade forte + comportamento linear | **SARIMAX** |
| Padr√µes n√£o-lineares complexos | **MLP ou Random Forest** |
| Linear + n√£o-linear misturados | **H√≠brido** |
| Dados com muitos outliers | **Random Forest** |
| Poucos dados dispon√≠veis | **SARIMAX** (n√£o precisa muitos dados) |
| Muitos dados + complexidade | **MLP ou H√≠brido** |

---

## 7Ô∏è‚É£ CONCLUS√ÉO

### Mensagem Principal

> **"N√£o existe um √∫nico modelo 'melhor'. A escolha depende do contexto: interpretabilidade vs performance, recursos dispon√≠veis, requisitos de manuten√ß√£o e caracter√≠sticas espec√≠ficas da s√©rie temporal."**

### Resumo dos Modelos

- **SARIMAX:** ‚ùå N√£o funcionou bem (MAPE 269%), por√©m interpret√°vel
- **MLP:** ü•à Excelente resultado (MAPE 9.62%, R¬≤ 0.997), captura n√£o-linearidades
- **Random Forest:** üèÜ Melhor modelo (MAPE 5.25%, R¬≤ 0.984), robusto e interpret√°vel via feature importance
- **H√≠brido:** ‚ùå Falhou (MAPE 279%), prejudicado pelo ARIMA ruim

### Trade-offs

```
Simplicidade ‚Üê‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Üí Performance
  SARIMAX      Random Forest   MLP   H√≠brido

Interpretabilidade ‚Üê‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Üí Flexibilidade
  SARIMAX      Random Forest   MLP   H√≠brido
```

### Recomenda√ß√£o Pr√°tica

Para o dataset **Household Consumption** com dados minuto-a-minuto:

1. üèÜ **MELHOR OP√á√ÉO:** **Random Forest** (MAPE 5.25%, R¬≤ 0.984)
   - Robusto, interpret√°vel via feature importance
   - Excelente equil√≠brio entre performance e manutenibilidade

2. ü•à **SEGUNDA OP√á√ÉO:** **MLP** (MAPE 9.62%, R¬≤ 0.997)
   - Captura padr√µes complexos com alta precis√£o
   - Ideal se voc√™ precisa de m√°xima flexibilidade

3. ‚ùå **N√ÉO RECOMENDADO:** SARIMAX ou H√≠brido
   - N√£o conseguiram capturar a complexidade dos dados
   - Modelos estat√≠sticos tradicionais podem n√£o funcionar bem em s√©ries muito granulares

---

## üìÅ Arquivos do Projeto

**Notebooks execut√°veis:**
- `models/household_consumption/SARIMAX.ipynb`
- `models/household_consumption/MLP.ipynb`
- `models/household_consumption/Random Forest.ipynb`
- `models/household_consumption/Hibrido (ARIMA + MLP).ipynb`
- `models/household_consumption/Comparacao.ipynb`

**Resultados gerados:**
- `out/household_consumption/[modelo]/` (gr√°ficos PNG + m√©tricas JSON + previs√µes CSV)
- `out/household_consumption/comparacao_metricas.csv` (tabela final)

---

## üéØ Para Executar

```bash
# 1. Instalar depend√™ncias
pip install -r requirements.txt

# 2. Executar notebooks em ordem
# (SARIMAX ‚Üí MLP ‚Üí Random Forest ‚Üí H√≠brido ‚Üí Comparacao)

# 3. Verificar resultados em out/household_consumption/
```

---

**FIM DA APRESENTA√á√ÉO** üéâ

*Tempo estimado: 5 minutos*  
*Projeto: An√°lise de S√©ries Temporais - Household Consumption*
